#!/bin/bash
# vim:set et sw=2:

aur_remove_package(){
  repo_path=$(aur repo --path-list) ;
  if repo_path=$(readlink -e "$repo_path"); then
    repo-remove "$repo_path" "$@"
    paccache -c "${repo_path%/*}" -rvk0 "$@"
  fi
}

name() {
  if [ -r /proc/sys/kernel/hostname ]; then
    cat /proc/sys/kernel/hostname
  else
    hostname | cut -d. -f1
  fi
}

if [ $# -gt 0 ]; then
  command="$1"
  shift
fi

case "$command" in
  screensaver)
    mode="random"
    if [[ "x--$1" == "x--off" ]]; then 
      mode="off"
    fi
    echo "XScreenSaver.mode: $mode" | xrdb -merge -
    xscreensaver-command -restart >/dev/null 2>&1
    echo "ScreenSaver mode set to $mode"
    ;;

  aur-remove)
    if [ "$#" -eq 0 ]; then
      printf "Usage: `basename "$0"` aur-remove [package ...]"
      exit 1
    fi
    aur_remove_package "$@"
    ;; 

  hostname)
    name
    ;;

  update)
    sudo pacman -Syu
    ;;

  setup)
    exec "harunou-setup" "$@"
    ;;

  config)
    exec "harunou-config" "$@"
    ;;

  media)
    exec "harunou-media" "$@"
    ;;

  ssl)
    exec "harunou-ssl" "$@"
    ;;

  openconnect|oc)
    exec "harunou-openconnect" "$@"
    ;;

  epo)
    exec "harunou-epo" "$@"
    ;;

  '') 
    echo "Usage: `basename "$0"` <command> [options]" 
    ;;

  *) 
    echo "`basename "$0"` $command: unknown command." >&2; exit 1 
    ;;
esac
