#!/bin/sh

as_root(){
  exec sudo "$@"
}

setup_shell() {
  zsh=$(grep 'zsh$' /etc/shells 2>/dev/null|head -1)
  if [ -x "$zsh" ] && grep "^$LOGNAME:" /etc/passwd >/dev/null; then
    if ! grep "^$LOGNAME:.*zsh" /etc/passwd >/dev/null; then
      echo "Changing login shell."
      chsh -s "$zsh"
    fi
  fi
}

setup_grml_zsh(){
  curl -o "$HOME/.zshrc" https://git.grml.org/f/grml-etc-core/etc/zsh/zshrc
}

command="$1"
shift

case "$command" in

  all)
    setup_shell
    setup_grml_zsh
    ;;

  update-grml-zsh)
    setup_grml_zsh
    ;;

  setup-iso)
    as_root mount / -o remount,size="$@"
    as_root loadkeys "$HOME/.keymaps/ruwin_sh_sh_UTF-8.map"
    ;;

  '') echo "Usage: `basename "$0"` <command> [options]" 
    ;;

  *) 
    echo "`basename "$0"` $command: unknown command." >&2; exit 1 
    ;;
esac
