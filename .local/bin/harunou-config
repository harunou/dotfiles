#!/bin/sh

files="\
  ./.login ./.profile \
  ./.zlogin ./.zprofile ./.zshenv ./.zshrc \
  ./.curlrc \
  ./.local/bin/harunou ./.local/bin/harunou-config \
  ./.local/bin/harunou-setup"

command="$1"
shift

case "$command" in
  tar) # flags
    cd
    exec tar "$@" $files
    ;;

  find) #starting_point, find params
    starting_point="$1"
    shift
    exec find "$starting_point" -name .git -prune -o -name install -prune -o -type f "$@"
    ;;

  setup-repo) #repo directory
    cd "$@"
    git config --replace-all remote.origin.url git@github.com:harunou/harunou.git
    git config alias.import '!harunou config find . -exec rm {} \; && harunou config tar -cf - | tar -xf -'
    git config alias.export '!harunou config find . -print0 | xargs -0 tar -cf - | harunou config tar -xf -'
    ;;

  clone) # destination directory
    set -e
    git clone https://github.com/harunou/harunou.git "$@"
    harunou config setup-repo "${1-harunou}"
    ;;

  '')
    echo "Usage: `basename "$0"` <command> [options]" 
    ;;

  *)
    echo "`basename "$0"` $command: unknown command." >&2; exit 1 
    ;;
esac
